# 学习笔记
## 作业
**在work目录下哦😉**
## 历史记录
### 功能模块
- 播发历史查看、播放进度同步, 离线型用户: app本地保留历史记录数据
- 可以考虑平台化, 在视频、文章、漫画等业务拓展接入
  - 变更功能: 添加记录、删除记录、清空历史
  - 读取功能: 按照timeline返回topN, 点查获取进度信息
  - 其它功能: 暂停/恢复记录, 首次观察增加经验等
- 具有极高tps写入, 高qps读取的业务服务, 分析清楚系统的hot path再投入优化 (可以考虑先本地再存储)
### 架构设计
- BFF
  - 数据组装
  - BFF的划分
    - 重要性
    - 垂直分层
    - 流量大小
    - 业务划分
- Service: history-service
  - 专注历史数据的持久化上
  - 负责数据的读、写、删、清理
  - 使用write-back的思路, 先写缓存再回写数据库
  - (在客户端上没有任何安全可言)
- Job: history-job
  - job消费上游kafka的数据, 利用消息队列的堆积能力, 
    对于存储层的差速(消费能力跟不上生产速度), 可以进行一定的数据反压, 
    配合上游的service批量打包过来的数据持久化
  - **批量打包(pipeline)聚合数据, 将高频、密集的写请求write-back, 批量消费减少对存储的直接压力**
- Upstream: some-app some-api
  - 整个历史服务还会被一些外部grpc服务依赖, 所以history还充当了内网的grpc Provider
